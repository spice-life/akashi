#!/usr/bin/env ruby

$LOAD_PATH.unshift(File.expand_path("../lib", __dir__))

require "yamler"
require "akashi"

unless ARGV.count == 3
  puts <<-EOS
Usage: bundle exec bin/akashi <action> <application> <environment>
       action choose from build, destroy
  EOS
  exit!
end

action, application, environment = ARGV

config_path = File.expand_path("../config", __dir__)

Akashi::AWS.config = Yamler.load(File.join(config_path, "aws.yml"))

Akashi.application = application
Akashi.environment = environment
Akashi.manifest    = Yamler.load(File.join(config_path, "#{Akashi.file_name}.yml.erb"))

Akashi.send(action.intern)
